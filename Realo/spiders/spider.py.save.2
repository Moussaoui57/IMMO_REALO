import scrapy
import re
from scrapy.http import Request, FormRequest

class SpiderSpider(scrapy.Spider):
    name = 'spider'
    allowed_domains = ['realo.be']
    #start_urls =['https://www.realo.be/sitemap/generated/listing.fr.1.xml','https://www.realo.be/sitemap/generated/address.xml','https://www.realo.be/sitemap/generated/contact.xml','https://www.realo.be/sitemap/generated/street.xml','https://www.realo.be/sitemap/generated/contact.xml','https://www.realo.be/sitemap/generated/street.xml','https://www.realo.be/sitemap/generated/locality.xml','https://www.realo.be/sitemap/generated/sublocality.xml'] #['http://https://www.realo.be/fr/']
    #start_urls =['https://www.realo.be/sitemap/generated/address.xml']
    start_urls=["https://www.realo.be/fr/08380-signy-le-petit/4329010791?l=1793654664","https://www.realo.be/fr/08380-signy-le-petit/4329010791?l=388739114","https://www.realo.be/fr/1000-brussel/5194008?l=1120738504","https://www.realo.be/fr/1000-brussel/5194008?l=1160152391","https://www.realo.be/fr/1000-brussel/5194008?l=1312674122","https://www.realo.be/fr/1000-brussel/5194008?l=1516051225","https://www.realo.be/fr/1000-brussel/5194008?l=167828796","https://www.realo.be/fr/1000-brussel/5194008?l=806525166","https://www.realo.be/fr/1000-brussel/5194008?l=821685144","https://www.realo.be/fr/1000-brussel/5198740?l=1552046654","https://www.realo.be/fr/1000-brussel/5198740?l=2009307119","https://www.realo.be/fr/1000-brussel/5198740?l=2019739503","https://www.realo.be/fr/1000-brussel/5198740?l=253987219","https://www.realo.be/fr/1000-brussel/5198781?l=1052946463","https://www.realo.be/fr/1000-brussel/5198781?l=899792826","https://www.realo.be/fr/1000-brussels/5198740?l=623481415","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1003395327%2C1694175994%2C571566695%2C1713348198","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1012459129%2C1810334881%2C965989688%2C1945353673","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1031762805%2C829593","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1052598222%2C8183280%2C1216876519%2C1041235431%2C236070457%2C677646355%2C1214389026%2C1242743899%2C1977122287%2C1585903594","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1094158355%2C283636264","https://www.realo.be/fr/1000-bruxelles/5194008?cl=119328454%2C1215009405","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1198263827%2C1000043160%2C1673894858","https://www.realo.be/fr/1000-bruxelles/5194008?cl=123406124%2C1604460079","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1235883225%2C1940660986%2C1574734632%2C2116914428","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1317148418%2C873051914%2C1354670008%2C75987078%2C1605368735%2C39864957%2C954283053","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1317866392%2C378827663%2C1879939089%2C2064696752","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1334142532%2C2114158538%2C359009035","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1395339444%2C668548954","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1450668004%2C1861125370%2C1834681774","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1465700155%2C360045374%2C2116181189","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1531925155%2C658672435%2C526028981","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1535882040%2C1031762805%2C829593","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1549992023%2C958954066","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1564464679%2C397687465%2C1621650283","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1584078482%2C700092650","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1591610362%2C1723529826%2C1706012200","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1608516891%2C647306456","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1658256473%2C1334015588%2C1872375201%2C1562257415","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1658448361%2C1541985984%2C76892367","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1671076954%2C405749938","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1708498183%2C914697745","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1736999913%2C922478089","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1849911126%2C1672948588%2C637593871","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1872200221%2C1421571188%2C949248999%2C928009699","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1950667794%2C207004989%2C1984891080","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1967348424%2C584385169","https://www.realo.be/fr/1000-bruxelles/5194008?cl=198881964%2C1878205374","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1990990783%2C1810490125","https://www.realo.be/fr/1000-bruxelles/5194008?cl=1994046752%2C217973458","https://www.realo.be/fr/1000-bruxelles/5194008?cl=2023289060%2C872705310","https://www.realo.be/fr/1000-bruxelles/5194008?cl=2023479829%2C497457802","https://www.realo.be/fr/1000-bruxelles/5194008?cl=2041336815%2C1077681317","https://www.realo.be/fr/1000-bruxelles/5194008?cl=205843875%2C1458021539","https://www.realo.be/fr/1000-bruxelles/5194008?cl=2058899892%2C293650721","https://www.realo.be/fr/1000-bruxelles/5194008?cl=2094631911%2C1881265756%2C716038117","https://www.realo.be/fr/1000-bruxelles/5194008?cl=292249123%2C1944939381%2C1627386339","https://www.realo.be/fr/1000-bruxelles/5194008?cl=315116116%2C356840538%2C866918062","https://www.realo.be/fr/1000-bruxelles/5194008?cl=329379640%2C96558281%2C787415170","https://www.realo.be/fr/1000-bruxelles/5194008?cl=333019676%2C927435232","https://www.realo.be/fr/1000-bruxelles/5194008?cl=34120383%2C1842529024","https://www.realo.be/fr/1000-bruxelles/5194008?cl=347808361%2C730769506","https://www.realo.be/fr/1000-bruxelles/5194008?cl=368294226%2C987174228","https://www.realo.be/fr/1000-bruxelles/5194008?cl=381437412%2C602591942%2C1793806377","https://www.realo.be/fr/1000-bruxelles/5194008?cl=456474576%2C893998773%2C1118429018%2C1816331493%2C1330115462","https://www.realo.be/fr/1000-bruxelles/5194008?cl=483424557%2C2047987758%2C1755268031%2C813011538%2C1553722736%2C749432475%2C2091124937","https://www.realo.be/fr/1000-bruxelles/5194008?cl=494182782%2C542501677","https://www.realo.be/fr/1000-bruxelles/5194008?cl=507716548%2C649842806","https://www.realo.be/fr/1000-bruxelles/5194008?cl=583843980%2C1224683647","https://www.realo.be/fr/1000-bruxelles/5194008?cl=602591942%2C1793806377","https://www.realo.be/fr/1000-bruxelles/5194008?cl=641454019%2C1519476260%2C133647171","https://www.realo.be/fr/1000-bruxelles/5194008?cl=642724279%2C159094917","https://www.realo.be/fr/1000-bruxelles/5194008?cl=689232%2C1745270551","https://www.realo.be/fr/1000-bruxelles/5194008?cl=698249823%2C1832460964","https://www.realo.be/fr/1000-bruxelles/5194008?cl=707185799%2C624454911%2C809155296%2C998542721","https://www.realo.be/fr/1000-bruxelles/5194008?cl=824275697%2C164430721","https://www.realo.be/fr/1000-bruxelles/5194008?cl=841966068%2C58037459%2C119328454%2C1215009405%2C200527593","https://www.realo.be/fr/1000-bruxelles/5194008?cl=853984405%2C630375031","https://www.realo.be/fr/1000-bruxelles/5194008?cl=867430758%2C1085372611","https://www.realo.be/fr/1000-bruxelles/5194008?cl=887060905%2C1879436809%2C2032694460","https://www.realo.be/fr/1000-bruxelles/5194008?cl=89113674%2C7130750","https://www.realo.be/fr/1000-bruxelles/5194008?cl=891364642%2C301508399","https://www.realo.be/fr/1000-bruxelles/5194008?cl=954769564%2C1339471799%2C10687765%2C30190753%2C1706056027%2C754315442","https://www.realo.be/fr/1000-bruxelles/5194008?l=1001518229","https://www.realo.be/fr/1000-bruxelles/5194008?l=1002938262","https://www.realo.be/fr/1000-bruxelles/5194008?l=100924972","https://www.realo.be/fr/1000-bruxelles/5194008?l=1014331551","https://www.realo.be/fr/1000-bruxelles/5194008?l=1016446530","https://www.realo.be/fr/1000-bruxelles/5194008?l=1030113153","https://www.realo.be/fr/1000-bruxelles/5194008?l=1033225291","https://www.realo.be/fr/1000-bruxelles/5194008?l=1034874943","https://www.realo.be/fr/1000-bruxelles/5194008?l=1036363080","https://www.realo.be/fr/1000-bruxelles/5194008?l=1044317674","https://www.realo.be/fr/1000-bruxelles/5194008?l=1058540120","https://www.realo.be/fr/1000-bruxelles/5194008?l=1066345202","https://www.realo.be/fr/1000-bruxelles/5194008?l=1066967396","https://www.realo.be/fr/1000-bruxelles/5194008?l=1073610627","https://www.realo.be/fr/1000-bruxelles/5194008?l=1073871940","https://www.realo.be/fr/1000-bruxelles/5194008?l=1078818675","https://www.realo.be/fr/1000-bruxelles/5194008?l=1096786856","https://www.realo.be/fr/1000-bruxelles/5194008?l=1107865693","https://www.realo.be/fr/1000-bruxelles/5194008?l=1109296181","https://www.realo.be/fr/1000-bruxelles/5194008?l=1114901847","https://www.realo.be/fr/1000-bruxelles/5194008?l=1120738504","https://www.realo.be/fr/1000-bruxelles/5194008?l=1122530465","https://www.realo.be/fr/1000-bruxelles/5194008?l=1128158665","https://www.realo.be/fr/1000-bruxelles/5194008?l=1132895025","https://www.realo.be/fr/1000-bruxelles/5194008?l=113549826","https://www.realo.be/fr/1000-bruxelles/5194008?l=1143675197","https://www.realo.be/fr/1000-bruxelles/5194008?l=1151260220","https://www.realo.be/fr/1000-bruxelles/5194008?l=1153938900","https://www.realo.be/fr/1000-bruxelles/5194008?l=1160152391","https://www.realo.be/fr/1000-bruxelles/5194008?l=1162126917","https://www.realo.be/fr/1000-bruxelles/5194008?l=1165310070","https://www.realo.be/fr/1000-bruxelles/5194008?l=1169409269","https://www.realo.be/fr/1000-bruxelles/5194008?l=1172200518","https://www.realo.be/fr/1000-bruxelles/5194008?l=1189119838","https://www.realo.be/fr/1000-bruxelles/5194008?l=1201656834","https://www.realo.be/fr/1000-bruxelles/5194008?l=1207222491","https://www.realo.be/fr/1000-bruxelles/5194008?l=1228423822","https://www.realo.be/fr/1000-bruxelles/5194008?l=1235016878","https://www.realo.be/fr/1000-bruxelles/5194008?l=1246555122","https://www.realo.be/fr/1000-bruxelles/5194008?l=1253268506","https://www.realo.be/fr/1000-bruxelles/5194008?l=1257760351","https://www.realo.be/fr/1000-bruxelles/5194008?l=1260579571","https://www.realo.be/fr/1000-bruxelles/5194008?l=1263884096","https://www.realo.be/fr/1000-bruxelles/5194008?l=1264577299","https://www.realo.be/fr/1000-bruxelles/5194008?l=1277567029","https://www.realo.be/fr/1000-bruxelles/5194008?l=1283854913","https://www.realo.be/fr/1000-bruxelles/5194008?l=1292658786","https://www.realo.be/fr/1000-bruxelles/5194008?l=1293971249","https://www.realo.be/fr/1000-bruxelles/5194008?l=1296329573","https://www.realo.be/fr/1000-bruxelles/5194008?l=12964705","https://www.realo.be/fr/1000-bruxelles/5194008?l=129898400","https://www.realo.be/fr/1000-bruxelles/5194008?l=1299559823","https://www.realo.be/fr/1000-bruxelles/5194008?l=1312674122","https://www.realo.be/fr/1000-bruxelles/5194008?l=1315877883","https://www.realo.be/fr/1000-bruxelles/5194008?l=1323857720","https://www.realo.be/fr/1000-bruxelles/5194008?l=1334343351","https://www.realo.be/fr/1000-bruxelles/5194008?l=1336432171","https://www.realo.be/fr/1000-bruxelles/5194008?l=1343942974","https://www.realo.be/fr/1000-bruxelles/5194008?l=1351773298","https://www.realo.be/fr/1000-bruxelles/5194008?l=1368382966","https://www.realo.be/fr/1000-bruxelles/5194008?l=1370683758","https://www.realo.be/fr/1000-bruxelles/5194008?l=1388488951","https://www.realo.be/fr/1000-bruxelles/5194008?l=1395052418","https://www.realo.be/fr/1000-bruxelles/5194008?l=1395775593","https://www.realo.be/fr/1000-bruxelles/5194008?l=139695973","https://www.realo.be/fr/1000-bruxelles/5194008?l=1397229200","https://www.realo.be/fr/1000-bruxelles/5194008?l=1399434416","https://www.realo.be/fr/1000-bruxelles/5194008?l=1406345027","https://www.realo.be/fr/1000-bruxelles/5194008?l=1408106965","https://www.realo.be/fr/1000-bruxelles/5194008?l=143786269","https://www.realo.be/fr/1000-bruxelles/5194008?l=1439526762","https://www.realo.be/fr/1000-bruxelles/5194008?l=1443959251","https://www.realo.be/fr/1000-bruxelles/5194008?l=1446643543","https://www.realo.be/fr/1000-bruxelles/5194008?l=1446832155","https://www.realo.be/fr/1000-bruxelles/5194008?l=1449136059","https://www.realo.be/fr/1000-bruxelles/5194008?l=1453877749","https://www.realo.be/fr/1000-bruxelles/5194008?l=1463845049","https://www.realo.be/fr/1000-bruxelles/5194008?l=146588956","https://www.realo.be/fr/1000-bruxelles/5194008?l=1473428447","https://www.realo.be/fr/1000-bruxelles/5194008?l=1477334733","https://www.realo.be/fr/1000-bruxelles/5194008?l=1481701220","https://www.realo.be/fr/1000-b]
    def parse4(self, response):
        item={}
        l=[]
        list_an=re.findall("(https[^<>\"]+)", response.text)
        #l[list_ann]
        print('*************************',list_an)
        for i in list_an:
            item['ANNONCE_TEXT']=i 
        #print("******************************",len(list_an))
            yield item 

    def parse(self , response):
        f = open('realo.txt', 'r')
        lignes = f.readlines()
        f.close()
        for url in lignes:
            print('****************************************',url)
            #url = url.strip("%0A")
            yield Request(url, self.parse_detail)


    def parse_detail(self, response):
        print("************************************************************************************************")
        item = {}
        item["ANNONCE_LINK"] = response.url
        item["NOM"] = response.xpath('//div[@class="type"]/strong/text()').extract_first().strip()
        item["ID_CLIENT"] = response.url.split("=")[1]
        yield item
